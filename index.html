<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stable.xyz Ultimate Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
    /* ---------------- GLOBAL STYLES ---------------- */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
}
body {
    background: #000;
    color: #fff;
    overflow: hidden;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

/* Particle Background Canvas */
#particle-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    opacity: 0.5;
}

.container {
    width: 90%;
    max-width: 950px;
    background: rgba(0,0,0,0.85);
    border-radius: 25px;
    border: 3px solid #0ff;
    box-shadow: 0 0 50px rgba(0,255,200,0.8), 0 0 100px rgba(0,255,200,0.3);
    padding: 40px;
    text-align: center;
    position: relative;
    z-index: 1;
    overflow: hidden;
    animation: fadeIn 2s ease;
    min-height: 550px;
}

h1 {
    font-size: 3rem;
    margin-bottom: 25px;
    text-shadow: 0 0 20px #0ff;
    animation: glowPulse 2s infinite alternate;
    font-weight: 900;
}

/* ---------------- SCREEN STYLES ---------------- */
.screen {
    display: none;
    animation: screenFadeIn 1s ease;
}
.screen.active {
    display: block;
}

#start-screen h1, #results-screen h2 {
    font-size: 3.5rem;
    color: #0ff;
}
.intro-text {
    font-size: 1.5rem;
    margin-bottom: 40px;
    color: #aaffdd;
}

/* ---------------- BUTTON STYLES ---------------- */
.main-btn {
    padding: 15px 40px;
    font-size: 1.4rem;
    background: #0ff;
    color: #000;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    margin: 10px;
    font-weight: bold;
    transition: 0.3s ease-in-out;
    box-shadow: 0 0 15px #0ff;
}
.main-btn:hover {
    background: #fff;
    box-shadow: 0 0 30px #0ff, 0 0 60px #0ff;
    transform: translateY(-3px);
}
.small-btn {
    font-size: 1rem;
    padding: 10px 20px;
    background: #2c5364;
    color: #0ff;
    box-shadow: none;
    border: 2px solid #0ff;
}
.small-btn:hover {
    background: #0ff;
    color: #000;
    box-shadow: 0 0 15px #0ff;
}

/* HIDES THE NEXT BUTTON PERMANENTLY */
.next-btn {
    display: none !important;
}

/* ---------------- QUIZ INFO BAR ---------------- */
.info-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding: 10px;
    border-bottom: 2px solid rgba(0,255,255,0.3);
}

.timer {
    font-size: 1.8rem;
    color: #ff4444;
    font-weight: bold;
    animation: pulseTimer 1s infinite;
}
.score-display, .streak-display {
    font-size: 1.5rem;
    font-weight: bold;
    color: #00ffaa;
}
#streak {
    transition: 0.2s transform;
}
.streak-bounce {
    animation: streakBounce 0.5s ease-out;
}

/* ---------------- QUESTION & OPTIONS ---------------- */
.question {
    font-size: 2rem;
    margin-bottom: 30px;
    color: #fff;
    animation: fadeInUp 1.5s ease;
    min-height: 80px;
}

.options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
}

button.option {
    padding: 20px;
    border: none;
    border-radius: 15px;
    font-size: 1.2rem;
    background: rgba(255,255,255,0.1);
    color: #fff;
    cursor: pointer;
    transition: 0.3s background, 0.3s transform, 0.3s box-shadow;
    box-shadow: 0 0 5px rgba(0,255,200,0.2);
}

button.option:hover {
    background: rgba(0,255,200,0.3);
    transform: scale(1.03);
    box-shadow: 0 0 15px #0ff;
}

button.correct {
    background: rgba(0, 255, 100, 0.7) !important;
    box-shadow: 0 0 20px #0f0, 0 0 40px #0f0 !important;
    animation: correctFlash 1s forwards;
}

button.wrong {
    background: rgba(255, 0, 0, 0.7) !important;
    animation: wrongShake 0.5s 3;
}

button.disabled-option {
    opacity: 0.3;
    pointer-events: none;
    background: rgba(255,255,255,0.05) !important;
}

/* ---------------- BOOSTS ---------------- */
.boost-container {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 20px;
}
.boost-btn {
    padding: 10px 20px;
    font-size: 1rem;
    background: #ffaa00;
    color: #000;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: 0.3s;
    box-shadow: 0 0 10px #ffaa00;
}
.boost-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #333;
    color: #888;
    box-shadow: none;
}
.boost-btn:hover:not(:disabled) {
    background: #fff;
    box-shadow: 0 0 20px #ffaa00;
}
.power-up-list {
    margin-bottom: 30px;
    padding: 15px;
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    text-align: left;
    display: inline-block;
}
.power-up-list h3 {
    color: #ffaa00;
    margin-bottom: 10px;
    text-align: center;
}

/* ---------------- PROGRESS BAR ---------------- */
.progress-bar-container {
    width: 100%;
    height: 10px;
    background: rgba(255,255,255,0.1);
    border-radius: 5px;
    margin-bottom: 20px;
    overflow: hidden;
}
#progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #0ff, #00ffaa);
    transition: width 0.5s ease;
}

/* ---------------- RESULTS SCREEN ---------------- */
#results-screen h2 {
    color: #0ff;
    margin-bottom: 15px;
}
.final-score-text {
    font-size: 2.5rem;
    font-weight: bold;
    color: #fff;
    margin-bottom: 30px;
}
#high-score-list {
    list-style: none;
    padding: 0;
    max-width: 400px;
    margin: 20px auto;
}
#high-score-list li {
    background: rgba(0,255,200,0.1);
    padding: 10px;
    margin-bottom: 8px;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    font-size: 1.1rem;
    border-left: 5px solid #0ff;
}

/* ---------------- ANIMATIONS ---------------- */
@keyframes glowPulse {
    0% { text-shadow: 0 0 10px #0ff, 0 0 20px #0ff; }
    100% { text-shadow: 0 0 25px #0ff, 0 0 50px #0ff; }
}
@keyframes fadeIn {
    from {opacity: 0; transform: scale(0.9);}
    to {opacity: 1; transform: scale(1);}
}
@keyframes screenFadeIn {
    from {opacity: 0; transform: translateY(20px);}
    to {opacity: 1; transform: translateY(0);}
}
@keyframes fadeInUp {
    from {transform: translateY(50px); opacity: 0;}
    to {transform: translateY(0); opacity: 1;}
}
@keyframes pulseTimer {
    0%, 100% { color: #ff4444; }
    50% { color: #ff0000; transform: scale(1.1); }
}
@keyframes correctFlash {
    0% { box-shadow: 0 0 10px #0f0; }
    50% { box-shadow: 0 0 40px #0f0; }
    100% { box-shadow: 0 0 20px #0f0; }
}
@keyframes wrongShake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
    100% { transform: translateX(0); }
}
@keyframes streakBounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.4); }
}

/* Confetti canvas */
#confetti {
    position: absolute;
    top: 0;
    left: 0;
    pointer-events: none;
    width: 100%;
    height: 100%;
    z-index: 5;
}
    </style>
</head>
<body>
    <canvas id="particle-bg"></canvas> <div class="container" id="main-container">
        <div id="start-screen" class="screen active">
            <h1>Stable.xyz Ultimate Quiz</h1>
            <p class="intro-text">Test your knowledge on Decentralized Identity (idOS)!</p>
            <button id="start-btn" class="main-btn">Start Quiz</button>
            <button id="rules-btn" class="main-btn small-btn">Rules & Boosts</button>
        </div>

        <div id="rules-screen" class="screen">
            <h2>Rules & Power-Ups</h2>
            <p>Answer all 10 questions before time runs out. Fast answers get a **Time Bonus**!</p>
            <div class="power-up-list">
                <h3>**Boosts Available:**</h3>
                <p>âš¡ **Skip:** Skip a tough question. (1 use)</p>
                <p>ðŸ”€ **50/50:** Remove two wrong answers. (1 use)</p>
            </div>
            <button id="back-to-start-btn" class="main-btn small-btn">Back</button>
        </div>

        <div id="quiz-screen" class="screen">
            <h1>Stable.xyz Quiz</h1>
            <div class="progress-bar-container"><div id="progress-bar"></div></div>
            <div class="info-bar">
                <span class="score-display">Score: <span id="score">0</span></span>
                <span class="streak-display">ðŸ”¥ <span id="streak">0</span></span>
                <div class="timer" id="timer">Time: 30</div>
            </div>
            
            <div class="question" id="question">Loading...</div>
            <div class="options" id="options"></div>
            
            <div class="boost-container">
                <button class="boost-btn" id="boost-50-50" data-boost="50/50">50/50 (1)</button>
                <button class="boost-btn" id="boost-skip" data-boost="Skip">Skip (1)</button>
            </div>

            <button class="next-btn" id="nextBtn">Next Question</button> 
        </div>

        <div id="results-screen" class="screen">
            <h2 id="final-message"></h2>
            <p class="final-score-text">Final Score: <span id="final-score">0</span></p>
            <h3>High Scores:</h3>
            <ul id="high-score-list"></ul>
            <button id="restart-btn" class="main-btn">Play Again</button>
        </div>

        <canvas id="confetti"></canvas>
    </div>

    <audio id="bgMusic" src="bg_music.mp3" loop></audio>
    <audio id="correctSound" src="funny_correct.mp3"></audio>
    <audio id="wrongSound" src="wrong_sfx.mp3"></audio>
    <audio id="boostSound" src="boost.mp3"></audio>

    <script>
       /* ---------------- QUIZ DATA ---------------- */
const questions = [
    {
        q: "What is Stable.xyz primarily focused on?",
        options: ["AI Models", "Decentralized Identity", "NFT Art", "Game Engines"],
        answer: 1
    },
    {
        q: "Stable provides SDKs for?",
        options: ["Identity Verification", "Mining", "AI Training", "3D Graphics"],
        answer: 0
    },
    {
        q: "What does the idOS stand for?",
        options: ["Identity Operating System", "Integrated Data OS", "Internet Digital OS", "Independent OS"],
        answer: 0
    },
    {
        q: "Which blockchain is supported by Stable?",
        options: ["Ethereum", "Solana", "Polkadot", "All of the above"],
        answer: 3
    },
    {
        q: "Main benefit of idOS?",
        options: ["Centralized storage", "User-controlled identity", "More ads", "Mining rewards"],
        answer: 1
    },
    {
        q: "What type of data can idOS store?",
        options: ["KYC Data", "Game Data", "Medical Records", "All of the above"],
        answer: 3
    },
    {
        q: "What is the mission of Stable?",
        options: ["To sell NFTs", "To decentralize identity & access", "To mine crypto", "To provide cloud services"],
        answer: 1
    },
    {
        q: "Developers can integrate Stable with?",
        options: ["APIs", "SDKs", "Smart contracts", "All of the above"],
        answer: 3
    },
    {
        q: "Who controls data in idOS?",
        options: ["Big Tech", "Governments", "The User", "Hackers"],
        answer: 2
    },
    {
        q: "Which website provides docs?",
        options: ["docs.stable.xyz", "stable.io", "stablechain.org", "idOS.net"],
        answer: 0
    }
];

/* ---------------- GAME STATE & DOM ELEMENTS ---------------- */
const DOM = {
    startScreen: document.getElementById("start-screen"),
    rulesScreen: document.getElementById("rules-screen"),
    quizScreen: document.getElementById("quiz-screen"),
    resultsScreen: document.getElementById("results-screen"),
    questionEl: document.getElementById("question"),
    optionsEl: document.getElementById("options"),
    timerEl: document.getElementById("timer"),
    scoreEl: document.getElementById("score"),
    streakEl: document.getElementById("streak"),
    boost5050Btn: document.getElementById("boost-50-50"),
    boostSkipBtn: document.getElementById("boost-skip"),
    progressBar: document.getElementById("progress-bar"),
    finalMessageEl: document.getElementById("final-message"),
    finalScoreEl: document.getElementById("final-score"),
    highScoreListEl: document.getElementById("high-score-list"),
    bgMusic: document.getElementById("bgMusic"),
    correctSound: document.getElementById("correctSound"),
    wrongSound: document.getElementById("wrongSound"),
    boostSound: document.getElementById("boostSound")
};

let gameState = {
    currentQuestion: 0,
    score: 0,
    streak: 0,
    maxTime: 30,
    timeRemaining: 30,
    countdown: null,
    boosts: {
        '50/50': 1,
        'Skip': 1
    },
    quizActive: false,
    highScores: JSON.parse(localStorage.getItem('stableQuizHighScores')) || []
};

const SCORE_SETTINGS = {
    BASE_POINTS: 100,
    TIME_BONUS_MULTIPLIER: 5,
    STREAK_BONUS_POINTS: 20
};

// Global animation frame ID for confetti control
let confettiAnimId = null;

/* ---------------- UTILITY & STATE MANAGEMENT ---------------- */

function switchScreen(newScreen) {
    const screens = [DOM.startScreen, DOM.rulesScreen, DOM.quizScreen, DOM.resultsScreen];
    screens.forEach(screen => screen.classList.remove('active'));
    newScreen.classList.add('active');
}

function updateScore(points) {
    gameState.score += points;
    DOM.scoreEl.textContent = gameState.score;
}

function updateBoostButtons() {
    DOM.boost5050Btn.textContent = `50/50 (${gameState.boosts['50/50']})`;
    DOM.boostSkipBtn.textContent = `Skip (${gameState.boosts['Skip']})`;

    DOM.boost5050Btn.disabled = gameState.boosts['50/50'] === 0;
    DOM.boostSkipBtn.disabled = gameState.boosts['Skip'] === 0;
}

function updateProgressBar() {
    const progress = (gameState.currentQuestion / questions.length) * 100;
    DOM.progressBar.style.width = `${progress}%`;
}

/* ---------------- TIMER ---------------- */

function startTimer() {
    gameState.timeRemaining = gameState.maxTime;
    DOM.timerEl.textContent = `Time: ${gameState.timeRemaining}`;

    clearInterval(gameState.countdown);

    gameState.countdown = setInterval(() => {
        gameState.timeRemaining--;
        DOM.timerEl.textContent = `Time: ${gameState.timeRemaining}`;

        if (gameState.timeRemaining <= 0) {
            clearInterval(gameState.countdown);
            // Treat as incorrect answer when time runs out
            selectAnswer(-1, questions[gameState.currentQuestion].answer, null);
        }
    }, 1000);
}

/* ---------------- QUIZ FLOW ---------------- */

function loadQuestion() {
    if (!gameState.quizActive) return;

    // Reset UI
    clearInterval(gameState.countdown);
    startTimer();
    updateBoostButtons();

    // Enable boosts again for the new question
    DOM.boost5050Btn.disabled = gameState.boosts['50/50'] === 0;
    DOM.boostSkipBtn.disabled = gameState.boosts['Skip'] === 0;

    const q = questions[gameState.currentQuestion];
    DOM.questionEl.textContent = q.q;
    DOM.optionsEl.innerHTML = "";

    q.options.forEach((opt, index) => {
        const btn = document.createElement("button");
        btn.classList.add("option");
        btn.textContent = opt;
        btn.dataset.index = index;
        btn.onclick = () => selectAnswer(index, q.answer, btn);
        DOM.optionsEl.appendChild(btn);
    });

    updateProgressBar();
}

function selectAnswer(selected, correct, selectedBtn) {
    if (!gameState.quizActive) return;

    clearInterval(gameState.countdown);
    const buttons = DOM.optionsEl.querySelectorAll("button");
    buttons.forEach(b => b.disabled = true);
    
    // Disable boosts after an answer is selected
    DOM.boost5050Btn.disabled = true;
    DOM.boostSkipBtn.disabled = true;

    if (selected === correct) {
        // Correct Answer Logic
        selectedBtn.classList.add("correct");
        DOM.correctSound.play();
        launchConfetti();

        // Scoring: Base + Time Bonus + Streak Bonus
        const timeSpent = gameState.maxTime - gameState.timeRemaining;
        const timeBonus = timeSpent > 0 ? (gameState.maxTime - timeSpent) * SCORE_SETTINGS.TIME_BONUS_MULTIPLIER : 0;
        
        gameState.streak++;
        const streakBonus = gameState.streak * SCORE_SETTINGS.STREAK_BONUS_POINTS;

        const totalPoints = SCORE_SETTINGS.BASE_POINTS + timeBonus + streakBonus;
        updateScore(totalPoints);
        
        DOM.streakEl.textContent = gameState.streak;
        DOM.streakEl.classList.add('streak-bounce');
        setTimeout(() => DOM.streakEl.classList.remove('streak-bounce'), 500);

    } else {
        // Wrong Answer Logic or Time Out
        if (selectedBtn) {
            selectedBtn.classList.add("wrong");
            DOM.wrongSound.play();
        }
        buttons[correct].classList.add("correct"); // Show correct answer
        
        // Reset streak
        gameState.streak = 0;
        DOM.streakEl.textContent = gameState.streak;
    }

    // AUTOMATIC JUMP to next question after 1 second
    setTimeout(goToNextQuestion, 1000);
}

function goToNextQuestion() {
    // Clear any residual confetti after transition time
    stopConfetti(); 
    
    gameState.currentQuestion++;
    if (gameState.currentQuestion < questions.length) {
        loadQuestion();
    } else {
        showResults();
    }
}

/* ---------------- BOOST HANDLERS ---------------- */

function handleBoost(boostType) {
    // Check if boost is available, quiz is active, and an answer hasn't been selected yet
    if (gameState.boosts[boostType] <= 0 || !gameState.quizActive) return; 
    
    DOM.boostSound.play();
    gameState.boosts[boostType]--;
    updateBoostButtons();

    if (boostType === '50/50') {
        apply5050();
    } else if (boostType === 'Skip') {
        applySkip();
    }
}

function apply5050() {
    const currentQ = questions[gameState.currentQuestion];
    const correctIndex = currentQ.answer;
    const options = DOM.optionsEl.querySelectorAll("button");
    
    const incorrectIndices = Array.from(options)
        .map(btn => parseInt(btn.dataset.index))
        .filter(index => index !== correctIndex);

    let disabledCount = 0;
    while (disabledCount < 2 && incorrectIndices.length > 0) {
        const randIndex = Math.floor(Math.random() * incorrectIndices.length);
        const indexToDisable = incorrectIndices.splice(randIndex, 1)[0];
        
        const btnToDisable = DOM.optionsEl.querySelector(`[data-index="${indexToDisable}"]`);
        if (btnToDisable) {
            btnToDisable.classList.add('disabled-option');
            btnToDisable.onclick = null;
            disabledCount++;
        }
    }

    DOM.boost5050Btn.disabled = true;
}

function applySkip() {
    gameState.streak = 0;
    DOM.streakEl.textContent = gameState.streak;
    goToNextQuestion();
}

// Attach listeners for boosts
DOM.boost5050Btn.onclick = () => handleBoost('50/50');
DOM.boostSkipBtn.onclick = () => handleBoost('Skip');

/* ---------------- RESULTS & HIGH SCORES ---------------- */

function showResults() {
    gameState.quizActive = false;
    clearInterval(gameState.countdown);
    switchScreen(DOM.resultsScreen);
    
    DOM.finalScoreEl.textContent = gameState.score;
    launchConfetti(200); // Massive confetti burst for completion

    if (gameState.score > 750) {
        DOM.finalMessageEl.textContent = "ðŸš€ Expert Identity Decentralizer!";
    } else if (gameState.score > 400) {
        DOM.finalMessageEl.textContent = "Great Work! Keep Building!";
    } else {
        DOM.finalMessageEl.textContent = "Good Effort! Time to Read the Docs.";
    }

    updateHighScores();
    
    // Stop confetti after results burst (4 seconds to let user see score)
    setTimeout(stopConfetti, 4000); 
}

function updateHighScores() {
    gameState.highScores.push({ score: gameState.score, date: new Date().toLocaleDateString() });
    
    gameState.highScores.sort((a, b) => b.score - a.score);
    gameState.highScores = gameState.highScores.slice(0, 10);

    localStorage.setItem('stableQuizHighScores', JSON.stringify(gameState.highScores));

    DOM.highScoreListEl.innerHTML = gameState.highScores.map((h, index) => 
        `<li>#${index + 1} - ${h.score} pts <span>(${h.date})</span></li>`
    ).join('');
}

/* ---------------- START/RESTART ---------------- */

function initializeGame() {
    gameState.currentQuestion = 0;
    gameState.score = 0;
    gameState.streak = 0;
    gameState.timeRemaining = gameState.maxTime;
    gameState.boosts = { '50/50': 1, 'Skip': 1 };

    DOM.scoreEl.textContent = gameState.score;
    DOM.streakEl.textContent = gameState.streak;
    
    updateProgressBar();
    updateBoostButtons();
    stopConfetti(); // Ensure confetti is cleared

    switchScreen(DOM.startScreen);
}

document.getElementById("start-btn").onclick = () => {
    gameState.quizActive = true;
    switchScreen(DOM.quizScreen);
    loadQuestion();
};

document.getElementById("rules-btn").onclick = () => switchScreen(DOM.rulesScreen);
document.getElementById("back-to-start-btn").onclick = () => switchScreen(DOM.startScreen);
document.getElementById("restart-btn").onclick = initializeGame;

/* ---------------- CONFETTI (Single Burst Logic) ---------------- */
const confettiCanvas = document.getElementById("confetti");
const ctx = confettiCanvas.getContext("2d");
confettiCanvas.width = window.innerWidth;
confettiCanvas.height = window.innerHeight;
let confettis = [];

function launchConfetti(count = 100) {
    stopConfetti(); 

    for (let i = 0; i < count; i++) {
        confettis.push({
            x: Math.random() * confettiCanvas.width,
            y: Math.random() * confettiCanvas.height - confettiCanvas.height,
            r: Math.random() * 6 + 4,
            d: Math.random() * 10 + 5,
            color: `hsl(${Math.random()*360},100%,50%)`,
            rotation: Math.random() * Math.PI * 2,
            tilt: Math.random() * 20 - 10
        });
    }

    drawConfetti();

    // Stop the animation after 2.5 seconds (the required 2-3 sec window)
    setTimeout(stopConfetti, 2500); 
}

function stopConfetti() {
    if (confettiAnimId) {
        cancelAnimationFrame(confettiAnimId);
    }
    confettiAnimId = null;
    confettis = [];
    ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
}

function drawConfetti() {
    if (confettis.length === 0) {
        stopConfetti();
        return;
    }

    ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
    confettis.forEach(c => {
        ctx.save();
        ctx.translate(c.x, c.y);
        ctx.rotate(c.rotation);
        
        ctx.fillStyle = c.color;
        ctx.fillRect(-c.r / 2, -c.r / 2, c.r, c.r * (Math.cos(c.tilt * (Math.PI / 180))));
        
        ctx.restore();
    });
    updateConfetti();
    confettiAnimId = requestAnimationFrame(drawConfetti);
}

function updateConfetti() {
    // Filter out confetti that has fallen off-screen, preventing an endless loop
    confettis = confettis.map(c => {
        c.y += c.d;
        c.rotation += c.d / 50;
        c.tilt += 0.5;
        return c;
    }).filter(c => c.y < confettiCanvas.height);
}

/* ---------------- PARTICLE BACKGROUND ANIMATION ---------------- */
const particleCanvas = document.getElementById("particle-bg");
const pCtx = particleCanvas.getContext("2d");
let particles = [];
const particleCount = 150;

// Particle Object Definition
class Particle {
    constructor(x, y) {
        this.x = x || Math.random() * particleCanvas.width;
        this.y = y || Math.random() * particleCanvas.height;
        this.radius = Math.random() * 2 + 1;
        this.velocity = {
            x: (Math.random() - 0.5) * 0.5,
            y: (Math.random() - 0.5) * 0.5
        };
        this.color = '#00ffcc';
        this.opacity = 0;
        this.life = 0;
        this.maxLife = 100;
    }

    draw() {
        pCtx.beginPath();
        pCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
        pCtx.fillStyle = `rgba(0, 255, 204, ${this.opacity})`;
        pCtx.fill();
    }

    update() {
        this.life++;
        this.opacity = 1 - Math.abs(this.life - (this.maxLife / 2)) / (this.maxLife / 2);

        this.x += this.velocity.x;
        this.y += this.velocity.y;

        if (this.x < 0 || this.x > particleCanvas.width) this.velocity.x *= -1;
        if (this.y < 0 || this.y > particleCanvas.height) this.velocity.y *= -1;
        
        if (this.life >= this.maxLife) {
             this.x = Math.random() * particleCanvas.width;
             this.y = Math.random() * particleCanvas.height;
             this.life = 0;
        }

        this.draw();
    }
}

function initParticles() {
    particles = [];
    for (let i = 0; i < particleCount; i++) {
        particles.push(new Particle());
    }
}

function animateParticles() {
    pCtx.fillStyle = 'rgba(0, 0, 0, 0.1)';
    pCtx.fillRect(0, 0, particleCanvas.width, particleCanvas.height);

    for (let i = 0; i < particles.length; i++) {
        particles[i].update();

        // Draw connecting lines (The "web" effect)
        for (let j = i + 1; j < particles.length; j++) {
            const dx = particles[i].x - particles[j].x;
            const dy = particles[i].y - particles[j].y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            const maxDistance = 100;
            if (distance < maxDistance) {
                pCtx.beginPath();
                pCtx.strokeStyle = `rgba(0, 255, 204, ${1 - distance / maxDistance})`;
                pCtx.lineWidth = 1;
                pCtx.moveTo(particles[i].x, particles[i].y);
                pCtx.lineTo(particles[j].x, particles[j].y);
                pCtx.stroke();
            }
        }
    }
    requestAnimationFrame(animateParticles);
}

// Handle resize for both canvases
window.addEventListener('resize', () => {
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;
    particleCanvas.width = window.innerWidth;
    particleCanvas.height = window.innerHeight;
    initParticles();
});

/* ---------------- START ---------------- */
window.onload = () => {
    // Initialize canvases
    particleCanvas.width = window.innerWidth;
    particleCanvas.height = window.innerHeight;
    initParticles();
    animateParticles();
    
    // Audio (will throw an error if files are missing, safe to remove if not used)
    DOM.bgMusic.volume = 0.3;
    DOM.bgMusic.play().catch(e => console.log("Background music autoplay failed:", e)); 
    
    // Start game state
    initializeGame();
};
    </script>
</body>
</html>
